<!DOCTYPE html>
<html>
	<head>

	</head>
	
	
	<body>
	<canvas width="500" height="500" id="canvas"></canvas>
	</body>

    <script src="libs/easeljs-0.7.1.min.js"></script>
	<script src="libs/Box2dWeb-2.1.a.3.min.js"></script>
    <script src="js/utils.js"></script>
	<script src="js/hero.js"></script>
	<script src="js/demo.js"></script>
	
	<script>
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		
		
		
		var    b2Vec2 = Box2D.Common.Math.b2Vec2
		,	   b2Cross = Box2D.Common.Math.b2Cross
		,      b2BodyDef = Box2D.Dynamics.b2BodyDef
		,      b2Body = Box2D.Dynamics.b2Body
		,      b2FixtureDef = Box2D.Dynamics.b2FixtureDef
		,      b2World = Box2D.Dynamics.b2World
		,      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape
		,      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape
		,      b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef
		,      b2MouseJointDef =  Box2D.Dynamics.Joints.b2MouseJointDef
		,      b2DebugDraw = Box2D.Dynamics.b2DebugDraw
		,      b2Fixture = Box2D.Dynamics.b2Fixture
		,      b2AABB = Box2D.Collision.b2AABB;
		
		
		
		var world = new b2World(new b2Vec2(0, 0), true);
	
	
		var bodyDef = new b2BodyDef;
		bodyDef.type = b2Body.b2_dynamicBody;
		bodyDef.position.Set(4, 8);
		bodyDef.userData = 'BOX';
		
		var myBody = world.CreateBody(bodyDef);
		
		myBody.SetPositionAndAngle(new b2Vec2(10,10),0);
		myBody.SetLinearVelocity(new b2Vec2(0, 0));
		myBody.SetFixedRotation(false);
		myBody.SetAngularVelocity(0);
		
		var myFixture = new b2FixtureDef;
		myFixture.shape = new b2CircleShape(2);
		myFixture.density = 1;
		myFixture.friction = 0.5;
		myFixture.restitution = .6;
		
		myBody.CreateFixture(myFixture);
		
		var debugDraw = new b2DebugDraw();
		debugDraw.SetSprite(document.getElementById ("canvas").getContext("2d"));
		debugDraw.SetDrawScale(10);
		debugDraw.SetFillAlpha(0.3); //define transparency
		debugDraw.SetLineThickness(1.0); //defines thickness of lines or boundaries
		debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
		world.SetDebugDraw(debugDraw);
		
		window.setInterval(update, 1000/60);
		
		var mouseX, mouseY, mousePVec, isMouseDown, selectedBody, mouseJoint;
		var canvasPosition = getElementPosition(document.getElementById("canvas")); 
		
		document.addEventListener("mousedown", function(e) {
			isMouseDown = true;
			handleMouseMove(e);
			document.addEventListener("mousemove", handleMouseMove, true);
		}, true);
		
		document.addEventListener("mouseup", function() {
			document.removeEventListener("mousemove", handleMouseMove, true);
			isMouseDown = false;
			mouseX = undefined;
			mouseY = undefined;
		}, true);
		
		function handleMouseMove(e) {
			mouseX = (e.clientX - canvasPosition.x) / 10;
			mouseY = (e.clientY - canvasPosition.y) / 10;
		};
		function getElementPosition(element) {
			var elem=element, tagname="", x=0, y=0;
			while((typeof(elem) == "object") && (typeof(elem.tagName) != "undefined")) {
				y += elem.offsetTop;
				x += elem.offsetLeft;
				tagname = elem.tagName.toUpperCase();
				if(tagname == "BODY")
					elem=0;
				if(typeof(elem) == "object") {
					if(typeof(elem.offsetParent) == "object") {
						elem = elem.offsetParent;
					}
				}
			}
			return {x: x, y: y};
		}
			
		function rotate_to_mouse() {
			var a1 = mouseY - myBody.GetPosition().y;
			var b1 = mouseX - myBody.GetPosition().x;
			var angle = Math.atan2(a1, b1);
			//var target = new b2Vec2(myBody.GetPosition().x, myBody.GetPosition().y);
			//var heading = new b2Vec2(mouseX, mouseY);
			//float cross = new b2Cross(target, heading);
			//if(cross == -0.0f) {
			//	myBody.SetAngularVelocity(Math.PI/2);
			//} else if (cross == 0.0f) {
			//	;
			//} else if(cross < 0.0f) {
			//	myBody.SetAngularVelocity(Math.PI/2);
			//} else if(cross > 0.0f) {
			//	myBody.SetAngularVelocity(-Math.PI/2);
			//}
			
			myBody.SetPositionAndAngle(myBody.GetPosition(), angle);
			

			//console.log(myBody.GetAngle());
			//console.log(angle);
			//while(isMouseDown && !
		
		}
		
		
			
		function update() {
			
			if(isMouseDown) {
				myBody.ApplyForce(new b2Vec2((mouseX - myBody.GetPosition().x)*10, (mouseY - myBody.GetPosition().y)*10), myBody.GetPosition());
				
				rotate_to_mouse();
			}
			
			world.Step(1/60, 10, 10);
			world.DrawDebugData();
			world.ClearForces();
		}

	</script>

</html>

	<!--Network Stuffs-->
	<!--this part may not be needed-->
	<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
	
	<script src="/socket.io/socket.io.js"></script>
	
	<!--3 requests to send and catch, send connection, update, disconnect-->
	<!--catch welcome, chat, notification-->
	<script 
	//listens for connection communciation
	io.sockets.on(
		'connection',
		function(client) {
			//reply to the client
			client.emit('welcome', 'Welcome to my chat room!');

    

			//listen for update
			client.on(
				'update',
				function(message) {
				// This function tries to get the user name from the client object, and
				// use that to form a chat message that will be sent to all clients.
				if (message && message.msg) {
					client.get(
						'user_name', 
						function(err, name) {
						if (!err) {
						// io.sockets.emit() will send the message to all clients,
						// including the current client. See socket.io FAQ for more
						// examples.
							io.sockets.emit('chat', { user_name: name, msg: message.msg });
						}
						});
					}
				});

		// Print a message when somebody left.
		client.on(
			'disconnect',
			function() {
			client.get(
				'user_name',
				function(err, name) {
					if (name) {
						io.sockets.emit('notification', name + ' left the room.');
					}
				});
			});
		});
	</script>
	